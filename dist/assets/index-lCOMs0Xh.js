var ye=Object.defineProperty;var ge=(e,t,s)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var I=(e,t,s)=>ge(e,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();const ve="modulepreload",be=function(e){return"/toasters-vs-loaves/"+e},N={},f=function(t,s,a){let o=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),r=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.allSettled(s.map(l=>{if(l=be(l),l in N)return;N[l]=!0;const c=l.endsWith(".css"),m=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${m}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":ve,c||(u.as="script"),u.crossOrigin="",u.href=l,r&&u.setAttribute("nonce",r),document.head.appendChild(u),c)return new Promise((y,w)=>{u.addEventListener("load",y),u.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(i){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i}return o.then(i=>{for(const r of i||[])r.status==="rejected"&&n(r.reason);return t().catch(n)})},S={COMMON:1,RARE:1.15,EPIC:1.35,LEGENDARY:1.6},F=[{key:"basic",name:"Counter Toaster",cost:100,rarity:S.COMMON,desc:"Reliable twoâ€‘slot toaster. Pops heat pellets at loaves.",base:{range:120,fireRate:1,damage:12,projectileSpeed:300},upgrades:[{name:"Bagel Mode",cost:60,effect:e=>e.damage+=6,tip:"+6 dmg"},{name:"Crumb Catcher",cost:80,effect:e=>e.range+=25,tip:"+25 range"},{name:"Turbo Springs",cost:110,effect:e=>e.fireRate+=.4,tip:"+0.4 firerate"}]},{key:"wide",name:"4â€‘Slot Toaster",cost:160,rarity:S.RARE,desc:"Wider heat, slower pop. Great coverage.",base:{range:150,fireRate:.7,damage:16,projectileSpeed:260},upgrades:[{name:"Quartz Rods",cost:90,effect:e=>e.damage+=10,tip:"+10 dmg"},{name:"Heat Shield",cost:70,effect:e=>e.range+=35,tip:"+35 range"},{name:"Dual Thermostat",cost:120,effect:e=>e.fireRate+=.35,tip:"+0.35 firerate"}]},{key:"oven",name:"Mini Oven",cost:220,rarity:S.RARE,desc:"Slow baker. Launches sizzling arcs (splash).",base:{range:170,fireRate:.5,damage:30,projectileSpeed:220,splash:40,splashDmg:14},upgrades:[{name:"Convection Fan",cost:110,effect:e=>{e.fireRate+=.25},tip:"+0.25 firerate"},{name:"Pizza Stone",cost:120,effect:e=>{e.damage+=16},tip:"+16 dmg"},{name:"Long Pan",cost:130,effect:e=>{e.range+=40},tip:"+40 range"}]},{key:"microwave",name:"Microwave",cost:260,rarity:S.EPIC,desc:"Zaps across lines instantly (pierce 2).",base:{range:190,fireRate:.8,damage:18,projectileSpeed:999,pierce:2},upgrades:[{name:"Inverter Tech",cost:140,effect:e=>e.damage+=10,tip:"+10 dmg"},{name:"Wave Guide",cost:150,effect:e=>e.range+=50,tip:"+50 range"},{name:"Autoâ€‘Reheat",cost:180,effect:e=>e.fireRate+=.5,tip:"+0.5 firerate"}]},{key:"airfryer",name:"Air Fryer",cost:340,rarity:S.EPIC,desc:"Rapid-fire hot air blasts. Lower damage but extreme speed.",base:{range:140,fireRate:3.5,damage:8,projectileSpeed:450},upgrades:[{name:"Cyclone Mode",cost:160,effect:e=>e.fireRate+=1.2,tip:"+1.2 firerate"},{name:"Precision Jets",cost:140,effect:e=>e.damage+=6,tip:"+6 dmg"},{name:"Extended Basket",cost:180,effect:e=>e.range+=45,tip:"+45 range"}]},{key:"convection",name:"Convection Oven",cost:420,rarity:S.EPIC,desc:"Creates persistent heat zones that slow and damage.",base:{range:200,fireRate:.3,damage:45,projectileSpeed:180,special:"heatzone"},upgrades:[{name:"Industrial Fan",cost:200,effect:e=>e.fireRate+=.2,tip:"+0.2 firerate"},{name:"Ceramic Core",cost:180,effect:e=>e.damage+=25,tip:"+25 dmg"},{name:"Wide Vents",cost:220,effect:e=>e.range+=60,tip:"+60 range"}]},{key:"industrial",name:"Industrial Toaster",cost:580,rarity:S.LEGENDARY,desc:"Massive chrome beast. Devastating damage but very slow.",base:{range:250,fireRate:.15,damage:120,projectileSpeed:200,splash:60,splashDmg:50},upgrades:[{name:"Tungsten Coils",cost:280,effect:e=>e.damage+=80,tip:"+80 dmg"},{name:"Hydraulic Lift",cost:320,effect:e=>e.fireRate+=.1,tip:"+0.1 firerate"},{name:"Chrome Reflector",cost:300,effect:e=>{e.range+=80,e.splash+=20},tip:"+80 range, +20 splash"}]},{key:"chef",name:"Chef Special Toaster",cost:480,rarity:S.LEGENDARY,desc:"Adaptive AI targeting. Switches modes based on threat level.",base:{range:180,fireRate:1.2,damage:35,projectileSpeed:350,special:"adaptive"},upgrades:[{name:"Neural Network",cost:240,effect:e=>{e.adaptiveBonus=.5},tip:"Enhanced adaptation"},{name:"Multi-Mode",cost:260,effect:e=>{e.damage+=20,e.fireRate+=.3},tip:"+20 dmg, +0.3 firerate"},{name:"Quantum Sensors",cost:300,effect:e=>{e.range+=70,e.pierce=1},tip:"+70 range, +1 pierce"}]}];function W(e){return F.find(t=>t.key===e)}const _e=[{key:"heat1",name:"Highâ€‘Temp Nichrome",cost:1,desc:"+10% damage to all appliances",action:e=>{for(const t of e.state.toasters)t.damage*=1.1;e.state.global.damage*=1.1}},{key:"coil1",name:"Coil Efficiency",cost:1,desc:"+10% fire rate to all",action:e=>{for(const t of e.state.toasters)t.fireRate*=1.1;e.state.global.fireRate*=1.1}},{key:"range1",name:"Insulated Housing",cost:1,desc:"+10% range to all",action:e=>{for(const t of e.state.toasters)t.range*=1.1;e.state.global.range*=1.1}},{key:"economy",name:"Coupon Clipping",cost:2,desc:"+15% coin bounty",action:e=>{e.state.global.bounty*=1.15}},{key:"pierce",name:"Serrated Slots",cost:3,desc:"Projectiles pierce +1",action:e=>{e.state.global.pierce=(e.state.global.pierce||0)+1}}],h={bind(e){document.getElementById("sellBtn").onclick=()=>e.sellSelected(),document.getElementById("rangeToggle").onchange=t=>{e.state.showRanges=t.target.checked},document.getElementById("startBtn").onclick=()=>{e.state.betweenWaves&&e.startWave()},this.refreshCatalog(e),this.refreshTech(e),this.refreshAbilities(),this.refreshAchievements(),this.sync(e)},log(e){const t=document.getElementById("log"),s=t.scrollTop+t.clientHeight>=t.scrollHeight-4;t.insertAdjacentHTML("beforeend",`<div>â€¢ ${e}</div>`),s&&(t.scrollTop=t.scrollHeight)},sync(e){document.getElementById("coins").textContent=e.state.coins,document.getElementById("lives").textContent=e.state.lives,document.getElementById("wave").textContent=e.state.wave,document.getElementById("ap").textContent=e.state.ap,this.updatePowerupDisplay()},refreshCatalog(e){const t=document.getElementById("catalog");t.innerHTML="";for(const s of F){const a=document.createElement("div");a.className="card",a.innerHTML=`<div class="row"><b>${s.name}</b><span class="badge">${s.cost}c</span></div>
        <div class="small">${s.desc}</div>
        <button class="placeBtn btn" ${e.state.coins<s.cost?"disabled":""}>Place</button>`,a.querySelector(".placeBtn").onclick=()=>{e.state.placing=s},t.appendChild(a)}},refreshTech(e){const t=document.getElementById("tech");t.innerHTML="";for(const s of _e){const a=document.createElement("div");a.className="tech",a.innerHTML=`<b>${s.name}</b><div class="small">${s.desc}</div>
      <button class="buy btn small">${`Buy (${s.cost} AP)`}</button>`,a.querySelector(".buy").onclick=()=>{if(e.state.ap<s.cost){this.log("Not enough AP. Survive more waves!");return}e.state.ap-=s.cost,this.sync(e),s.action(e),this.log(`Tech unlocked: ${s.name}`),this.refreshTech(e),this.updateInspect(e)},t.appendChild(a)}},updateInspect(e){const t=document.getElementById("inspectSection"),s=document.getElementById("inspect"),a=e.getSelected();if(!a){t.style.display="none",s.innerHTML="";return}t.style.display="block";const o=W(a.type),n=a.level<o.upgrades.length,i=n?o.upgrades[a.level]:null;s.innerHTML=`
      <div class="row"><b>${a.name}</b><span class="small">ID ${a.id}</span></div>
      <div class="keyline"></div>
      <div class="small">Range: ${a.range.toFixed(0)} | Dmg: ${a.damage.toFixed(0)} | Fire/s: ${a.fireRate.toFixed(2)}${a.pierce?` | Pierce: ${a.pierce}`:""}${a.splash?` | Splash: ${a.splash}`:""}</div>
      <div class="keyline"></div>
      ${n?`
        <div class="row"><div>Next: <b>${i.name}</b><div class="small">${i.tip}</div></div>
        <button id="upgradeBtn" class="btn small" ${e.state.coins<i.cost?"disabled":""}>Upgrade (${i.cost}c)</button></div>
      `:'<div class="small">Maxed out. Shines like new chrome.</div>'}
    `,n&&(document.getElementById("upgradeBtn").onclick=()=>{e.state.coins<i.cost||(e.state.coins-=i.cost,this.sync(e),i.effect(a),a.level++,this.float(e,a.x,a.y,"Upgrade!"),this.updateInspect(e),this.refreshCatalog(e))})},float(e,t,s,a,o=!1){e.state.texts.push({x:t,y:s,str:a,isBad:o,t:0})},updatePowerupDisplay(){f(async()=>{const{activePowerups:e,POWERUP_TYPES:t}=await Promise.resolve().then(()=>ke);return{activePowerups:e,POWERUP_TYPES:t}},void 0).then(({activePowerups:e,POWERUP_TYPES:t})=>{const s=document.getElementById("powerupDisplay"),a=document.getElementById("activePowerups");if(e.length===0)s.style.display="none";else{s.style.display="block";const o=e.map(n=>{const i=t[n.type];return`<span style="color: ${i.color}">${i.name} (${Math.ceil(n.duration)}s)</span>`});a.innerHTML=o.join(", ")}})},refreshAbilities(){f(async()=>{const{getAbilityStatus:e}=await Promise.resolve().then(()=>Ne);return{getAbilityStatus:e}},void 0).then(({getAbilityStatus:e})=>{const t=document.getElementById("abilitiesDisplay"),s=e();let a='<div class="hint">Hotkeys: Q, W, E, R. Abilities cost coins except Emergency Coins.</div>';for(const o of s){const n=o.ready?"ready":"cooldown",i=o.ready?0:o.cooldown/o.maxCooldown*100;a+=`
          <div class="ability ${n}">
            <div class="ability-info">
              <div><strong>${o.name}</strong> ${o.cost>0?`(${o.cost}c)`:"(Free)"}</div>
              <div class="small">${o.description}</div>
              ${o.ready?"":`<div class="cooldown-bar"><div class="cooldown-progress" style="width: ${i}%"></div></div>`}
            </div>
            <div class="ability-key">${o.hotkey}</div>
          </div>
        `}t.innerHTML=a})},refreshAchievements(){f(async()=>{const{achievements:e,getAchievementProgress:t}=await Promise.resolve().then(()=>U);return{achievements:e,getAchievementProgress:t}},void 0).then(({achievements:e,getAchievementProgress:t})=>{const s=document.getElementById("achievementsDisplay"),a=t();let o=`<div class="hint">Achievements: ${a.unlocked}/${a.total} (${a.percentage}%)</div>`;for(const n of e){const i=n.unlocked?"unlocked":"locked";o+=`
          <div class="achievement ${i}">
            <div class="achievement-icon">${n.icon}</div>
            <div class="achievement-text">
              <div class="achievement-name">${n.name}</div>
              <div class="achievement-desc">${n.description}</div>
            </div>
          </div>
        `}s.innerHTML=o})}},g=Object.freeze(Object.defineProperty({__proto__:null,UI:h},Symbol.toStringTag,{value:"Module"}));function we(e,t){return{w:e,h:t,coins:150,lives:100,wave:0,ap:0,placing:null,selected:null,showRanges:!0,running:!1,global:{damage:1,fireRate:1,range:1,bounty:1,pierce:0},waveQueue:[],spawnTimer:0,betweenWaves:!0,waveInProgress:!1,idSeq:1,toasters:[],texts:[]}}const Se=36,v=[{x:-20,y:80},{x:160,y:80},{x:160,y:160},{x:320,y:160},{x:320,y:60},{x:560,y:60},{x:560,y:260},{x:420,y:260},{x:420,y:420},{x:780,y:420},{x:780,y:200},{x:980,y:200}],C={cw:30,ch:30};function Pe(e,t,s,a,o,n){const i=o-s,r=n-a,l=e-s,c=t-a,m=i*l+r*c;if(m<=0)return Math.hypot(e-s,t-a);const u=i*i+r*r;if(u<=m)return Math.hypot(e-o,t-n);const y=m/u,w=s+y*i,H=a+y*r;return Math.hypot(e-w,t-H)}function G(e,t){for(let s=0;s<v.length-1;s++){const a=v[s],o=v[s+1];if(Pe(e,t,a.x,a.y,o.x,o.y)<=Se)return!0}return!1}function Ee(e,t){return!G(e,t)}const E=[],b={intensity:0,duration:0};function Y(e,t,s=50,a=5,o=3){E.push({x:e,y:t,radius:s,damage:a,duration:o,maxDuration:o,id:++Te})}function K(e,t){for(const s of E){if(s.duration-=e,s.duration<=0){s.dead=!0;continue}for(const a of t.breads||[]){if(!a.alive)continue;if(Math.hypot(a.x-s.x,a.y-s.y)<=s.radius&&(a.hp-=s.damage*e,a.speed*=.7,a.hp<=0)){a.alive=!1;const n=Math.round(a.bounty*t.global.bounty);t.coins+=n}}}for(let s=E.length-1;s>=0;s--)E[s].dead&&E.splice(s,1);b.duration>0&&(b.duration-=e,b.intensity*=.9)}function D(e=5,t=.3){b.intensity=e,b.duration=t}function Q(e,t){if(!t.length)return null;const s=t.filter(r=>r.hp>100),a=t.filter(r=>r.speed>80),o=t.filter(r=>r.wpt>8);let n="balanced";s.length>3?n="tank":a.length>5?n="speed":o.length>2&&(n="proximity");const i=e.adaptiveBonus||0;switch(n){case"tank":return e._tempDamage=e.damage*(1+i),s.reduce((r,l)=>!r||l.hp>r.hp?l:r,null);case"speed":return e._tempFireRate=e.fireRate*(1+i),a.reduce((r,l)=>!r||l.speed>r.speed?l:r,null);case"proximity":return e._tempRange=e.range*(1+i*.5),o.reduce((r,l)=>!r||l.wpt>r.wpt?l:r,null);default:return t.reduce((r,l)=>{const c=1e3-l.wpt*50+Math.hypot(l.x-e.x,l.y-e.y)*.1;return!r||c<r._score?{...l,_score:c}:r},null)}}let Te=0;const A=Object.freeze(Object.defineProperty({__proto__:null,addScreenShake:D,createHeatZone:Y,getAdaptiveTargeting:Q,heatZones:E,screenShake:b,stepEffects:K},Symbol.toStringTag,{value:"Module"})),P=[],T=[],O={SPEED_BOOST:{name:"Speed Boost",color:"#00ff00",duration:8,effect:e=>{e.global.fireRate*=1.5;for(const t of e.toasters)t.fireRate*=1.5},cleanup:e=>{e.global.fireRate/=1.5;for(const t of e.toasters)t.fireRate/=1.5}},DAMAGE_AMP:{name:"Damage Amplifier",color:"#ff4444",duration:10,effect:e=>{e.global.damage*=2;for(const t of e.toasters)t.damage*=2},cleanup:e=>{e.global.damage/=2;for(const t of e.toasters)t.damage/=2}},COIN_MAGNET:{name:"Coin Magnet",color:"#ffd700",duration:15,effect:e=>{e.global.bounty*=3},cleanup:e=>{e.global.bounty/=3}},FREEZE_TIME:{name:"Freeze Time",color:"#4da6ff",duration:5,effect:e=>{e._freezeActive=!0},cleanup:e=>{e._freezeActive=!1}},SUPER_HEAT:{name:"Super Heat",color:"#ff8800",duration:12,effect:e=>{e.global.pierce+=2,e.global.fireRate*=1.3;for(const t of e.toasters)t.pierce+=2,t.fireRate*=1.3},cleanup:e=>{e.global.pierce-=2,e.global.fireRate/=1.3;for(const t of e.toasters)t.pierce-=2,t.fireRate/=1.3}}};function q(e,t,s=null){if(!s){const a=Object.keys(O);s=a[Math.floor(Math.random()*a.length)]}P.push({id:++Me,x:e,y:t,type:s,bobTime:0,sparkleTime:0,life:15})}function Z(e,t){for(const s of P)s.life-=e,s.bobTime+=e*3,s.sparkleTime+=e*5,s.life<=0&&(s.dead=!0);for(let s=P.length-1;s>=0;s--)P[s].dead&&P.splice(s,1);for(const s of T)s.duration-=e,s.duration<=0&&(s.dead=!0,O[s.type].cleanup(t));for(let s=T.length-1;s>=0;s--)T[s].dead&&T.splice(s,1);f(async()=>{const{UI:s}=await Promise.resolve().then(()=>g);return{UI:s}},void 0).then(({UI:s})=>{s.updatePowerupDisplay()})}function J(e,t,s){for(const a of P)if(Math.hypot(e-a.x,t-a.y)<=25)return X(a.type,s),a.dead=!0,f(async()=>{const{recordPowerupCollected:n}=await Promise.resolve().then(()=>U);return{recordPowerupCollected:n}},void 0).then(({recordPowerupCollected:n})=>{n()}),!0;return!1}function X(e,t){for(const a of T)a.type===e&&(O[e].cleanup(t),a.dead=!0);const s=O[e];T.push({type:e,duration:s.duration,name:s.name}),s.effect(t),f(async()=>{const{UI:a}=await Promise.resolve().then(()=>g);return{UI:a}},void 0).then(({UI:a})=>{a.log(`ðŸš€ ${s.name} activated!`)}),f(async()=>{const{addScreenShake:a}=await Promise.resolve().then(()=>A);return{addScreenShake:a}},void 0).then(({addScreenShake:a})=>{a(3,.2)})}function x(e,t){let s=.05;e.r>15?s=.3:e.type==="rye"?s=.15:e.type==="baguette"&&(s=.08),Math.random()<s&&q(e.x,e.y)}let Me=0;const ke=Object.freeze(Object.defineProperty({__proto__:null,POWERUP_TYPES:O,activatePowerup:X,activePowerups:T,powerups:P,rollPowerupDrop:x,spawnPowerup:q,stepPowerups:Z,tryCollectPowerup:J},Symbol.toStringTag,{value:"Module"})),M=[],B=[];function Re(e,t,s=10){for(let a=0;a<s;a++){const o=Math.random()*Math.PI*2,n=Math.random()*150+50;M.push({x:e,y:t,vx:Math.cos(o)*n,vy:Math.sin(o)*n,g:200,life:Math.random()*.6+.4,type:"explosion",color:`hsl(${Math.random()*60+10}, 80%, ${Math.random()*30+50}%)`})}}function Ie(e,t,s){for(let a=0;a<5;a++){const o=(Math.random()-.5)*.8,n=s+o,i=Math.random()*100+80;M.push({x:e,y:t,vx:Math.cos(n)*i,vy:Math.sin(n)*i,g:0,life:.15,type:"muzzle",color:"#ffff88"})}}function Ce(e,t,s,a=!1){B.push({x:e,y:t,damage:Math.round(s),life:1.5,vy:-60,isCrit:a,scale:a?1.5:1})}function Ae(e){for(const t of M)t.type!=="muzzle"&&(t.vy+=t.g*e),t.x+=t.vx*e,t.y+=t.vy*e,t.life-=e,t.life<=0&&(t.dead=!0);for(const t of B)t.y+=t.vy*e,t.vy*=.95,t.life-=e,t.life<=0&&(t.dead=!0);for(let t=M.length-1;t>=0;t--)M[t].dead&&M.splice(t,1);for(let t=B.length-1;t>=0;t--)B[t].dead&&B.splice(t,1)}const k=[{id:"first_kill",name:"Toasted!",description:"Defeat your first bread enemy",unlocked:!1,icon:"ðŸž"},{id:"wave_10",name:"Baker's Dozen Survivor",description:"Survive 10 waves",unlocked:!1,icon:"ðŸ†"},{id:"boss_killer",name:"Boss Basher",description:"Defeat your first boss",unlocked:!1,icon:"ðŸ’€"},{id:"powerup_collector",name:"Power Hungry",description:"Collect 10 powerups",unlocked:!1,icon:"âš¡"},{id:"tower_master",name:"Master Chef",description:"Build all 8 tower types",unlocked:!1,icon:"ðŸ‘¨â€ðŸ³"},{id:"coin_hoarder",name:"Coin Collector",description:"Accumulate 5000 coins",unlocked:!1,icon:"ðŸ’°"},{id:"ability_user",name:"Special Forces",description:"Use all 4 special abilities",unlocked:!1,icon:"ðŸš€"}],d={enemiesKilled:0,wavesCompleted:0,bossesKilled:0,powerupsCollected:0,towersBuilt:new Set,abilitiesUsed:new Set,highestWave:0,totalCoinsEarned:0,playtimeSeconds:0};function R(){for(const e of k){if(e.unlocked)continue;let t=!1;switch(e.id){case"first_kill":t=d.enemiesKilled>=1;break;case"wave_10":t=d.wavesCompleted>=10;break;case"boss_killer":t=d.bossesKilled>=1;break;case"powerup_collector":t=d.powerupsCollected>=10;break;case"tower_master":t=d.towersBuilt.size>=8;break;case"coin_hoarder":t=d.totalCoinsEarned>=5e3;break;case"ability_user":t=d.abilitiesUsed.size>=4;break}t&&(e.unlocked=!0,ee(e),ie())}}function ee(e){f(async()=>{const{UI:t}=await Promise.resolve().then(()=>g);return{UI:t}},void 0).then(({UI:t})=>{t.log(`ðŸŽ‰ Achievement Unlocked: ${e.icon} ${e.name}!`),t.refreshAchievements()}),f(async()=>{const{addScreenShake:t}=await Promise.resolve().then(()=>A);return{addScreenShake:t}},void 0).then(({addScreenShake:t})=>{t(5,.3)})}function te(e){d.enemiesKilled++,e.r>15&&d.bossesKilled++,R()}function se(){d.wavesCompleted++,d.highestWave=Math.max(d.highestWave,d.wavesCompleted),R()}function Be(){d.powerupsCollected++,R()}function oe(e){d.towersBuilt.add(e),R()}function $e(e){d.abilitiesUsed.add(e),R()}function ae(e){d.totalCoinsEarned+=e,R()}function ne(e){d.playtimeSeconds+=e}function ie(){try{localStorage.setItem("toasters-vs-loaves-achievements",JSON.stringify(k)),localStorage.setItem("toasters-vs-loaves-stats",JSON.stringify({...d,towersBuilt:Array.from(d.towersBuilt),abilitiesUsed:Array.from(d.abilitiesUsed)}))}catch{console.log("Could not save stats to localStorage")}}function re(){try{const e=localStorage.getItem("toasters-vs-loaves-achievements");if(e){const s=JSON.parse(e);for(let a=0;a<k.length&&a<s.length;a++)k[a].unlocked=s[a].unlocked}const t=localStorage.getItem("toasters-vs-loaves-stats");if(t){const s=JSON.parse(t);Object.assign(d,s),d.towersBuilt=new Set(s.towersBuilt||[]),d.abilitiesUsed=new Set(s.abilitiesUsed||[])}}catch{console.log("Could not load stats from localStorage")}}function Oe(){const e=k.length,t=k.filter(s=>s.unlocked).length;return{unlocked:t,total:e,percentage:Math.round(t/e*100)}}const U=Object.freeze(Object.defineProperty({__proto__:null,achievements:k,checkAchievements:R,gameStats:d,getAchievementProgress:Oe,loadStats:re,recordAbilityUsed:$e,recordCoinsEarned:ae,recordEnemyKilled:te,recordPowerupCollected:Be,recordTowerBuilt:oe,recordWaveCompleted:se,saveStats:ie,showAchievementUnlock:ee,stepStats:ne},Symbol.toStringTag,{value:"Module"})),_=[];function le(e){const t=e.size==="large"?20:12,s={id:++de,type:e.type,hp:e.hp,maxHp:e.hp,speed:e.speed,bounty:e.bounty,wpt:0,x:v[0].x,y:v[0].y,r:t,alive:!0,special:e.special||null,armor:e.armor||0,lastSpeedBurst:0,regenerateTimer:0};_.push(s)}function ce(e,t){const s=t._freezeActive?e*.1:e;for(const a of _){if(!a.alive)continue;a.special==="regenerate"&&(a.regenerateTimer+=s,a.regenerateTimer>=2&&a.hp<a.maxHp&&(a.hp=Math.min(a.maxHp,a.hp+a.maxHp*.1),a.regenerateTimer=0));let o=a.speed;a.special==="speed_burst"&&(a.lastSpeedBurst+=s,a.lastSpeedBurst>=4?(o=a.speed*2.5,a.lastSpeedBurst=-1):a.lastSpeedBurst<0&&(o=a.speed*2.5,a.lastSpeedBurst+=s,a.lastSpeedBurst>=0&&(a.lastSpeedBurst=0)));const n=v[a.wpt+1];if(!n){if(a.alive=!1,!t._invulnerable){const u=a.r>15?5:1;t.lives-=u,document.getElementById("lives").textContent=t.lives,t.lives<=0&&(t.running=!1)}continue}const i=n.x-a.x,r=n.y-a.y,l=Math.hypot(i,r);if(l<2){a.wpt++;continue}const c=i/l*o,m=r/l*o;a.x+=c*s,a.y+=m*s}}function j(e,t,s){const a=t*(1-(e.armor||0));e.hp-=a;const o=a>e.maxHp*.3;if(Ce(e.x,e.y-10,a,o),e.hp<=0){if(e.alive=!1,te(e),Re(e.x,e.y,e.r>15?20:8),x(e),e.special==="split"&&e.r>15)for(let i=0;i<3;i++){const r=i*Math.PI*2/3+Math.random()*.5,l={id:++de,type:"sourdough_split",hp:e.maxHp*.3,maxHp:e.maxHp*.3,speed:e.speed*1.2,bounty:Math.floor(e.bounty*.3),wpt:e.wpt,x:e.x+Math.cos(r)*25,y:e.y+Math.sin(r)*25,r:8,alive:!0,special:null,armor:0,lastSpeedBurst:0,regenerateTimer:0};_.push(l)}const n=Math.round(e.bounty*s.global.bounty);s.coins+=n,ae(n),document.getElementById("coins").textContent=s.coins,e.r>15&&(s.ap+=2,D(8,.5),h.log("ðŸ’€ Boss defeated! +2 AP bonus!"))}}let de=0;const V=Object.freeze(Object.defineProperty({__proto__:null,breads:_,damageBread:j,spawnBread:le,stepBreads:ce},Symbol.toStringTag,{value:"Module"})),$=[];function Le(e,t,s=null){const a=Math.atan2(t.y-e.y,t.x-e.x),o=e.projectileSpeed,n=s||e.damage,i={id:++ze,x:e.x,y:e.y,vx:Math.cos(a)*o,vy:Math.sin(a)*o,dmg:n,pierce:e.pierce||0,splash:e.splash||0,splashDmg:e.splashDmg||0,life:2};$.push(i)}function De(e,t){for(const s of $){s.x+=s.vx*e,s.y+=s.vy*e,s.life-=e,s.life<=0&&(s.dead=!0);for(const a of _)if(a.alive&&Math.hypot(s.x-a.x,s.y-a.y)<=a.r){if(j(a,s.dmg,t),s.splash>0)for(const o of _){if(!o.alive)continue;Math.hypot(s.x-o.x,s.y-o.y)<=s.splash&&o!==a&&j(o,s.splashDmg,t)}if(s.pierce>0)s.pierce--;else{s.dead=!0;break}}}for(let s=$.length-1;s>=0;s--)$[s].dead&&$.splice(s,1)}let ze=0;function He(e,t){const s=t.w,a=t.h;if(b.duration>0){const o=(Math.random()-.5)*b.intensity*2,n=(Math.random()-.5)*b.intensity*2;e.save(),e.translate(o,n)}e.clearRect(0,0,s,a),e.fillStyle="#0d1017",e.fillRect(0,0,s,a);for(let o=0;o<a;o+=C.ch)for(let n=0;n<s;n+=C.cw){const i=n+C.cw/2,r=o+C.ch/2,l=G(i,r);e.fillStyle=l?"#1d2331":"#111827",e.fillRect(n,o,C.cw-1,C.ch-1)}e.strokeStyle="#2a3246",e.lineWidth=8,e.beginPath(),e.moveTo(v[0].x,v[0].y);for(let o=1;o<v.length;o++){const n=v[o];e.lineTo(n.x,n.y)}e.stroke();for(const o of _){if(!o.alive)continue;const n=o.hp/o.maxHp;if(e.save(),e.translate(o.x,o.y),o.type==="sourdough_boss")e.fillStyle="#d4a574",p(e,-o.r,-o.r*.8,o.r*2,o.r*1.6,o.r*.4),e.fillStyle="#b8956a",p(e,-o.r*.8,-o.r*.6,o.r*1.6,o.r*.8,o.r*.3),n<.7&&(e.strokeStyle="#8b6f47",e.lineWidth=2,e.beginPath(),e.moveTo(-o.r*.5,-o.r*.3),e.lineTo(-o.r*.2,o.r*.2),e.moveTo(o.r*.3,-o.r*.4),e.lineTo(o.r*.6,o.r*.1),e.stroke());else if(o.type==="french_boss"){if(e.fillStyle="#e8c5a0",p(e,-o.r*1.2,-o.r*.6,o.r*2.4,o.r*1.2,o.r*.2),e.fillStyle="#d4b087",p(e,-o.r,-o.r*.4,o.r*2,o.r*.6,o.r*.15),o.lastSpeedBurst<0){e.strokeStyle="#ff6b35",e.lineWidth=3;for(let l=0;l<5;l++)e.beginPath(),e.arc(0,0,o.r+l*3,0,Math.PI*2),e.stroke()}}else if(o.type==="pretzel_boss"){e.fillStyle="#8b7355",e.beginPath();for(let l=0;l<8;l++){const c=l*Math.PI/4,m=o.r*(.8+.4*Math.sin(c*3)),u=Math.cos(c)*m,y=Math.sin(c)*m;l===0?e.moveTo(u,y):e.lineTo(u,y)}e.closePath(),e.fill(),e.fillStyle="#696969",p(e,-o.r*.6,-o.r*.6,o.r*1.2,o.r*1.2,3)}else e.fillStyle="#c58a55",p(e,-o.r*.875,-o.r*.625,o.r*1.75,o.r*1.25,o.r*.5),e.fillStyle="#8c5a2f",p(e,-o.r*.875,-o.r*.75,o.r*1.75,o.r*.5,o.r*.375);const i=o.r*1.75,r=o.r>15?5:3;if(e.fillStyle="#000000aa",e.fillRect(-i/2,-o.r-r*2,i,r),e.fillStyle=n>.4?"#7bd88f":"#ff6b6b",e.fillRect(-i/2,-o.r-r*2,i*n,r),o.r>15){e.fillStyle="#ffd700",e.beginPath();for(let l=0;l<5;l++){const c=l*Math.PI*2/5-Math.PI/2,m=o.r+8,u=o.r+4,y=Math.cos(c)*m,w=Math.sin(c)*m,H=Math.cos(c+Math.PI/5)*u,me=Math.sin(c+Math.PI/5)*u;l===0?e.moveTo(y,w):e.lineTo(y,w),e.lineTo(H,me)}e.closePath(),e.fill()}e.restore()}for(const o of t.toasters){if(e.save(),e.translate(o.x,o.y),o.type==="airfryer")e.fillStyle="#8a7ca8",p(e,-16,-14,32,28,6),e.fillStyle="#b8a9c9",p(e,-14,-12,28,10,4),e.fillStyle="#2b2f3c",e.fillRect(-8,-6,6,4),e.fillRect(2,-6,6,4),e.strokeStyle="#6a5aed",e.lineWidth=2,e.beginPath(),e.arc(0,0,8,0,Math.PI*2),e.stroke();else if(o.type==="convection"){e.fillStyle="#c67e3b",p(e,-18,-16,36,32,8),e.fillStyle="#e2945a",p(e,-16,-14,32,12,6),e.fillStyle="#8b4513",p(e,-12,-8,24,8,4),e.strokeStyle="#ff6b35aa",e.lineWidth=1;for(let n=0;n<3;n++)e.beginPath(),e.arc(0,0,12+n*4,0,Math.PI*2),e.stroke()}else o.type==="industrial"?(e.fillStyle="#778899",p(e,-20,-18,40,36,8),e.fillStyle="#c0c0c0",p(e,-18,-16,36,14,6),e.fillStyle="#1a1a1a",p(e,-14,-10,28,12,4),e.fillStyle="#ffffff44",p(e,-16,-14,8,3,2)):o.type==="chef"?(e.fillStyle="#9932cc",p(e,-16,-14,32,28,6),e.fillStyle="#dda0dd",p(e,-14,-12,28,10,4),e.fillStyle="#00ff00",e.beginPath(),e.arc(8,0,3,0,Math.PI*2),e.fill(),e.fillStyle="#0066ff",e.beginPath(),e.arc(-8,0,3,0,Math.PI*2),e.fill()):(e.fillStyle="#9aa3b2",p(e,-16,-14,32,28,6),e.fillStyle="#cfd6e2",p(e,-14,-12,28,10,4),e.fillStyle="#2b2f3c",e.fillRect(-10,-6,8,4),e.fillRect(2,-6,8,4),e.fillStyle="#1e2230",e.beginPath(),e.arc(12,4,4,0,Math.PI*2),e.fill());t.showRanges&&(!t.selected||t.selected===o.id)&&(e.strokeStyle="#3a445f66",e.beginPath(),e.arc(0,0,o.range,0,Math.PI*2),e.stroke()),e.restore()}for(const o of $)e.fillStyle="#ffd166",e.beginPath(),e.arc(o.x,o.y,3,0,Math.PI*2),e.fill();for(const o of E){const n=o.duration/o.maxDuration;e.fillStyle=`rgba(255, 100, 50, ${n*.3})`,e.beginPath(),e.arc(o.x,o.y,o.radius,0,Math.PI*2),e.fill(),e.strokeStyle=`rgba(255, 150, 100, ${n*.6})`,e.lineWidth=2,e.stroke()}for(const o of M)if(o.type==="explosion"){e.fillStyle=o.color;const n=o.life/.6*4;e.fillRect(o.x-n/2,o.y-n/2,n,n)}else if(o.type==="muzzle"){e.fillStyle=o.color;const n=o.life/.15;e.globalAlpha=n,e.fillRect(o.x-2,o.y-2,4,4),e.globalAlpha=1}else e.fillStyle="#e7c08a88",e.fillRect(o.x,o.y,2,2);for(const o of B){const n=o.life/1.5;e.globalAlpha=n,e.fillStyle=o.isCrit?"#ff6b35":"#ffd166",e.font=`${12*o.scale}px ui-monospace,Consolas`,e.strokeStyle="#000000",e.lineWidth=2,e.strokeText(o.damage.toString(),o.x,o.y),e.fillText(o.damage.toString(),o.x,o.y),e.globalAlpha=1}for(const o of P){const n=Math.sin(o.bobTime)*3,i=Math.sin(o.sparkleTime)*.3+.7,r=Math.min(1,o.life/3);e.save(),e.translate(o.x,o.y+n),e.globalAlpha=r;const l=O[o.type];e.fillStyle=l.color+"44",e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.fillStyle=l.color,e.globalAlpha=r*i,e.beginPath(),e.arc(0,0,8,0,Math.PI*2),e.fill();for(let c=0;c<6;c++){const m=(o.sparkleTime+c*Math.PI/3)%(Math.PI*2),u=12+Math.sin(o.sparkleTime*2+c)*2,y=Math.cos(m)*u,w=Math.sin(m)*u;e.fillStyle="#ffffff"+Math.floor(i*255).toString(16).padStart(2,"0"),e.fillRect(y-1,w-1,2,2)}e.restore()}for(const o of t.texts){const n=1-Math.min(1,o.t/1.2);e.globalAlpha=n,e.fillStyle=o.isBad?"#ff6b6b":"#ffd166",e.font="12px ui-monospace,Consolas",e.fillText(o.str,o.x,o.y-10-20*o.t),e.globalAlpha=1,o.t+=1/60}b.duration>0&&e.restore()}function p(e,t,s,a,o,n){e.beginPath(),e.moveTo(t+n,s),e.arcTo(t+a,s,t+a,s+o,n),e.arcTo(t+a,s+o,t,s+o,n),e.arcTo(t,s+o,t,s,n),e.arcTo(t,s,t+a,s,n),e.closePath(),e.fill()}function We(e){const t=[];if(e%10===0)return je(e);const s=15+Math.floor(e*1.5);for(let a=0;a<s;a++)t.push({type:"slice",hp:20+4*e,speed:70+1.5*e,bounty:4});if(e%3===0)for(let a=0;a<6+Math.floor(e/2);a++)t.push({type:"baguette",hp:80+10*e,speed:60+1.2*e,bounty:9});if(e%5===0)for(let a=0;a<3+Math.floor(e/3);a++)t.push({type:"rye",hp:180+18*e,speed:55+1.1*e,bounty:15});e>=5&&e%7===0&&t.push({type:"croissant",hp:300+25*e,speed:50+1*e,bounty:30,special:"regenerate"});for(let a=t.length-1;a>0;a--){const o=Math.random()*(a+1)|0;[t[a],t[o]]=[t[o],t[a]]}return t}function je(e){const t=[],s=Math.floor(e/10),a=Math.min(8,3+s);for(let o=0;o<a;o++)t.push({type:"baguette",hp:120+15*e,speed:65+2*e,bounty:12});return s===1||s%3===1?t.push({type:"sourdough_boss",hp:800+200*s,speed:40+s*2,bounty:150+50*s,special:"split",size:"large"}):s%3===2?t.push({type:"french_boss",hp:600+150*s,speed:35+s*2,bounty:120+40*s,special:"speed_burst",size:"large"}):t.push({type:"pretzel_boss",hp:1200+300*s,speed:25+s,bounty:200+75*s,special:"armor",armor:.5,size:"large"}),t}const z={LIGHTNING_STRIKE:{name:"Lightning Strike",hotkey:"Q",cooldown:15,cost:100,description:"Strikes all enemies with lightning, dealing massive damage",currentCooldown:0,effect:e=>{f(async()=>{const{breads:t,damageBread:s}=await Promise.resolve().then(()=>V);return{breads:t,damageBread:s}},void 0).then(({breads:t,damageBread:s})=>{f(async()=>{const{addScreenShake:a}=await Promise.resolve().then(()=>A);return{addScreenShake:a}},void 0).then(({addScreenShake:a})=>{let o=0;for(const n of t)n.alive&&(s(n,150,e.state),o++);a(10,.8),f(async()=>{const{UI:n}=await Promise.resolve().then(()=>g);return{UI:n}},void 0).then(({UI:n})=>{n.log(`âš¡ Lightning Strike hit ${o} enemies!`)})})})}},HEAT_WAVE:{name:"Heat Wave",hotkey:"W",cooldown:20,cost:150,description:"Creates heat zones at all enemy positions",currentCooldown:0,effect:e=>{f(async()=>{const{breads:t}=await Promise.resolve().then(()=>V);return{breads:t}},void 0).then(({breads:t})=>{f(async()=>{const{createHeatZone:s,addScreenShake:a}=await Promise.resolve().then(()=>A);return{createHeatZone:s,addScreenShake:a}},void 0).then(({createHeatZone:s,addScreenShake:a})=>{let o=0;for(const n of t)n.alive&&(s(n.x,n.y,60,12,4),o++);a(6,.4),f(async()=>{const{UI:n}=await Promise.resolve().then(()=>g);return{UI:n}},void 0).then(({UI:n})=>{n.log(`ðŸ”¥ Heat Wave created ${o} burning zones!`)})})})}},REPAIR_ALL:{name:"Repair All",hotkey:"E",cooldown:25,cost:200,description:"Instantly repairs 50 lives and gives temporary invulnerability",currentCooldown:0,effect:e=>{e.state.lives=Math.min(100,e.state.lives+50),e.state._invulnerable=!0,setTimeout(()=>{e.state._invulnerable=!1},5e3),f(async()=>{const{UI:t}=await Promise.resolve().then(()=>g);return{UI:t}},void 0).then(({UI:t})=>{t.log("ðŸ’š Repaired 50 lives + 5s invulnerability!"),t.sync(e)}),f(async()=>{const{addScreenShake:t}=await Promise.resolve().then(()=>A);return{addScreenShake:t}},void 0).then(({addScreenShake:t})=>{t(4,.3)})}},EMERGENCY_COINS:{name:"Emergency Coins",hotkey:"R",cooldown:30,cost:0,description:"Grants emergency coins based on current wave",currentCooldown:0,effect:e=>{const t=200+e.state.wave*25;e.state.coins+=t,f(async()=>{const{UI:s}=await Promise.resolve().then(()=>g);return{UI:s}},void 0).then(({UI:s})=>{s.log(`ðŸ’° Emergency funds: +${t} coins!`),s.sync(e)}),f(async()=>{const{addScreenShake:s}=await Promise.resolve().then(()=>A);return{addScreenShake:s}},void 0).then(({addScreenShake:s})=>{s(3,.2)})}}};function fe(e){let t=!1;for(const s of Object.values(z))if(s.currentCooldown>0){const a=s.currentCooldown;s.currentCooldown-=e,s.currentCooldown<0&&(s.currentCooldown=0),Math.floor(a)!==Math.floor(s.currentCooldown)&&(t=!0)}t&&f(async()=>{const{UI:s}=await Promise.resolve().then(()=>g);return{UI:s}},void 0).then(({UI:s})=>{s.refreshAbilities()})}function ue(e,t){for(const s of Object.values(z))if(s.hotkey.toLowerCase()===e.toLowerCase())return s.currentCooldown>0?(f(async()=>{const{UI:a}=await Promise.resolve().then(()=>g);return{UI:a}},void 0).then(({UI:a})=>{a.log(`${s.name} on cooldown (${Math.ceil(s.currentCooldown)}s)`)}),!1):t.state.coins<s.cost?(f(async()=>{const{UI:a}=await Promise.resolve().then(()=>g);return{UI:a}},void 0).then(({UI:a})=>{a.log(`Not enough coins for ${s.name} (need ${s.cost})`)}),!1):(t.state.coins-=s.cost,s.currentCooldown=s.cooldown,s.effect(t),f(async()=>{const{recordAbilityUsed:a}=await Promise.resolve().then(()=>U);return{recordAbilityUsed:a}},void 0).then(({recordAbilityUsed:a})=>{a(e)}),f(async()=>{const{UI:a}=await Promise.resolve().then(()=>g);return{UI:a}},void 0).then(({UI:a})=>{a.sync(t)}),!0);return!1}function Ue(){return Object.entries(z).map(([e,t])=>({key:e,name:t.name,hotkey:t.hotkey,cooldown:t.currentCooldown,maxCooldown:t.cooldown,cost:t.cost,description:t.description,ready:t.currentCooldown===0}))}const Ne=Object.freeze(Object.defineProperty({__proto__:null,getAbilityStatus:Ue,specialAbilities:z,stepAbilities:fe,tryActivateAbility:ue},Symbol.toStringTag,{value:"Module"}));class Ve{constructor(t,s){I(this,"canvas");I(this,"ctx");I(this,"state");I(this,"mouse",{x:-999,y:-999});I(this,"last",performance.now());this.canvas=t,this.ctx=s,this.state=we(t.width,t.height)}init(){h.bind(this),re(),this.canvas.addEventListener("mousemove",t=>{this.mouse.x=t.offsetX,this.mouse.y=t.offsetY}),this.canvas.addEventListener("mouseleave",()=>{this.mouse.x=this.mouse.y=-9999}),this.canvas.addEventListener("click",t=>{const s=t.offsetX,a=t.offsetY;if(J(s,a,this.state))return;const o=this.state.toasters.findLast(n=>Math.hypot(s-n.x,a-n.y)<=18);if(o){this.state.selected=o.id,h.updateInspect(this);return}this.state.placing&&this.tryPlaceTower(s,a,t.shiftKey)}),document.addEventListener("keydown",t=>{t.target.tagName!=="INPUT"&&ue(t.key,this)}),h.refreshCatalog(this),h.refreshTech(this),h.log("Welcome to Toasters vs Loaves! Place toasters and press Start Wave. Earn AP to buy Tech."),h.log("ðŸ’¡ Special abilities: Q-Lightning, W-Heat Wave, E-Repair, R-Emergency Coins")}stepTime(t){const s=Math.min(.033,(t-this.last)/1e3);return this.last=t,s}tryPlaceTower(t,s,a=!1){if(!Ee(t,s)){h.float(this,t,s,"Not on loaf path!",!0);return}const o=this.state.placing;if(!o)return;if(this.state.coins<o.cost){h.float(this,t,s,"Not enough coins",!0);return}for(const i of this.state.toasters)if(Math.hypot(t-i.x,s-i.y)<36){h.float(this,t,s,"Too close to another toaster",!0);return}const n=this.makeToaster(o,t,s);this.state.toasters.push(n),this.state.coins-=o.cost,h.sync(this),h.log(`Placed ${o.name} for ${o.cost}c.`),h.refreshCatalog(this),D(2,.2),oe(o.key),a||(this.state.placing=null)}makeToaster(t,s,a){return{id:this.state.idSeq++,type:t.key,name:t.name,x:s,y:a,range:t.base.range*this.state.global.range,fireRate:t.base.fireRate*this.state.global.fireRate,damage:t.base.damage*this.state.global.damage,projectileSpeed:t.base.projectileSpeed||300,splash:t.base.splash||0,splashDmg:t.base.splashDmg||0,pierce:(t.base.pierce||0)+this.state.global.pierce,level:0,path:0,cooldown:0,sold:!1,special:t.base.special||null,adaptiveBonus:0}}sellSelected(){const t=this.getSelected();if(!t)return;t.sold=!0;const s=Math.floor(.8*this.getTowerCost(t));this.state.coins+=s,h.sync(this),this.state.toasters=this.state.toasters.filter(a=>a.id!==t.id),this.state.selected=null,h.updateInspect(this),h.refreshCatalog(this),h.float(this,t.x,t.y,`+${s}c (sold)`)}getTowerCost(t){const s=W(t.type).cost;let a=0;const o=W(t.type).upgrades;for(let n=0;n<t.level;n++)a+=o[n].cost;return s+a}getSelected(){return this.state.toasters.find(t=>t.id===this.state.selected)}startWave(){this.state.waveInProgress||(this.state.wave++,h.sync(this),h.log(`Wave ${this.state.wave} begins!`),this.state.waveQueue=We(this.state.wave),this.state.spawnTimer=0,this.state.betweenWaves=!1,this.state.waveInProgress=!0,this.state.running=!0)}update(t){if(this.state.waveInProgress&&(this.state.spawnTimer-=t,this.state.spawnTimer<=0&&this.state.waveQueue.length&&(le(this.state.waveQueue.shift()),this.state.spawnTimer=.45),!this.state.waveQueue.length&&_.every(s=>!s.alive)&&(this.state.waveInProgress=!1,this.state.betweenWaves=!0,this.state.ap+=1,this.state.coins+=50+this.state.wave*10,h.sync(this),h.log(`Wave ${this.state.wave} cleared! +AP, +coins`),se())),ce(t,this.state),this.state.running)for(const s of this.state.toasters){s.cooldown-=t,s.cooldown<0&&(s.cooldown=0),s._tempDamage=s.damage,s._tempFireRate=s.fireRate,s._tempRange=s.range;let a=null;if(s.special==="adaptive"){const o=_.filter(n=>n.alive&&Math.hypot(n.x-s.x,n.y-s.y)<=s.range);a=Q(s,o)}else{let o=1/0;for(const n of _){if(!n.alive)continue;const i=Math.hypot(n.x-s.x,n.y-s.y);if(i<=s.range){const r=1e3-n.wpt*50+i*.1;r<o&&(o=r,a=n)}}}if(a&&s.cooldown===0){if(s.special==="heatzone")Y(a.x,a.y,45,8,2.5),D(3,.15);else{const n=Math.atan2(a.y-s.y,a.x-s.x);Ie(s.x,s.y,n),Le(s,a,s._tempDamage||s.damage)}const o=s._tempFireRate||s.fireRate;s.cooldown=Math.max(.02,1/o)}}De(t,this.state),Ae(t),K(t,this.state),Z(t,this.state),fe(t),ne(t)}draw(){He(this.ctx,this.state)}}const he=document.getElementById("game"),Fe=he.getContext("2d"),L=new Ve(he,Fe);L.init();function pe(e){const t=L.stepTime(e);L.update(t),L.draw(),requestAnimationFrame(pe)}requestAnimationFrame(pe);
